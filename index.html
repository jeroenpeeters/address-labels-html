<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Address Labels</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
  </head>
  <body>
    <span class="noPrint">
      <h1>A4 Address Label Maker for 70x37mm labels</h1>
      <div>
        Select a csv file:
        <input type="file" id="fileInput">
      </div>
      <pre id="fileDisplayArea"></pre>
    </span>
    <div id="content"></div>


    <script>
    window.onload = function() {
      var fileInput = document.getElementById('fileInput');
      var fileDisplayArea = document.getElementById('fileDisplayArea');

      fileInput.addEventListener('change', function(e) {
        var file = fileInput.files[0];
        var textType = /text.*/;
        if (file.type.match(textType)) {
          var reader = new FileReader();

          reader.onload = function(e) {
            objects = $.csv.toObjects(reader.result);
            fileDisplayArea.innerText = JSON.stringify(objects)
            //fileDisplayArea.innerText = reader.result;
            var html = '';

            for(idx in objects){
              idx = parseInt(idx)
              row = objects[idx]
              console.log(typeof idx, idx, idx+1, (idx+1) % 8,  (idx+1) % 8 == 0);
              address = '<span class="name">'+row.Naam+'</span>'
              address += '<span class="street">'+row['Straat + Huisnummer']+'</span>'
              address += '<span class="postalcode">'+row.Postcode+'</span>'
              address += '<span class="city">'+row.Plaats+'</span>'

              if(row.Land){
                address += '<span class="country">'+row.Land+'</span>'
              }
              html += '<td><span class="sticker">'+address+'</span></td>'
              if( (idx+1) % 24 == 0){
                html += '</tr></table><table><tr>'
              }else if( (idx+1) % 3 == 0){
                html += '</tr><tr>'
              }
            }
            $('#content').html('<table><tr>'+html+'</tr></table>');
          }

          reader.readAsText(file);
        } else {
          fileDisplayArea.innerText = "File not supported!";
        }
      });
    }
    </script>
  </body>
</html>
